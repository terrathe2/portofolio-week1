<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>To Do Fancy API</title>
    <!-- <script type="text/javascript" href="/assets/JS/jquery.3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script> -->
    <script
			  src="https://code.jquery.com/jquery-3.2.1.min.js"
			  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
			  crossorigin="anonymous">
    </script>
    <!-- <script href="assets/JS/validate-email.js"></script> -->
  </head>
  <body>
    <form id="loginform" style="display:none" method="post">
      <span id="logerror"></span><br>
      <label>Username</label><br>
      <input type="text" name="username" placeholder="input your username here" required /><br>
      <label>Password</label><br>
      <input type="password" name="password" placeholder="input your password here" required /><br>
      <input type="submit" value="Login"/> <a id="register" style="cursor:pointer;">Register</a>
    </form>

    <form id="registerform" style="display:none" method="post">
      <span id="signerror"></span><br>
      <label>Username</label><br>
      <input type="text" name="signusername" placeholder="input your username here" /><br>
      <label>Password</label><br>
      <input type="password" name="signpassword" placeholder="input your password here" /><br>
      <label>Email</label><br>
      <input id="email" type="email" name="signemail" placeholder="input your email here" /> <span id="emailerr"></span><br>
      <input type="submit" value="Register" /> <a class="back" style="cursor:pointer;">Back</a>
    </form>

    <div id="content" style="display:none">
      HAI
    </div>
  </body>
  <script type="text/javascript">
  $(document).ready(function(){
    if (localStorage.getItem('token')) {
      $('#content').show(200)
    } else {
      $('#loginform').show(200)
    }

    // Login
    $('#loginform').on('submit', function(ev) {
      ev.preventDefault();

      let inputData = {
        username: $('input[name=username]').val(),
        password: $('input[name=password]').val()
      }

      $.ajax({
        type: 'post',
        url: 'http://localhost:3000/users/login',
        data: inputData,
        dataType: 'json',
        success: function(response) {
          if (!response.data) {
            $("#logerror").html(response.message)
          } else {
            localStorage.setItem('token', response.data)
            window.location.reload()
          }
        },

        fail: function() {
          console.log("ERROR")
        }
      })
    })

    // Register
    $('#registerform').on('submit', function(ev) {
      ev.preventDefault();

      let inputData = {
        username: $('input[name=signusername]').val(),
        password: $('input[name=signpassword]').val(),
        email: $('input[name=signemail]').val()
      }

      $.ajax({
        type: 'post',
        url: 'http://localhost:3000/users/register',
        data: inputData,
        dataType: 'json',
        success: function(response) {
          if (!response.data) {
            $("#signerror").html(response.message)
          } else {
            localStorage.setItem('token', response.data)
            window.location.reload()
          }
        },

        fail: function() {
          console.log("ERROR")
        }
      })
    })

    // email validation regex
    $('#email').on('keypress', function(){
      let pattern = /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
      if (!pattern.test(this.value)) {
        $('#emailerr').html("<img src='assets/images/false.png' width='12'> Invalid Email Address").css({"color":"red"}).show()
        $("#email").css({"border":"2px solid red","border-radius":"5px","padding":"2px"})
      } else {
        $('#emailerr').html("<img src='assets/images/true.png' width='12'> Cool Email!").css({"color": "green"}).show()
        $("#email").css({"border":"2px solid green","border-radius":"5px","padding":"2px"})
      }
    })

    $('#register').on('click', function(){
      $('#loginform').hide(200)
      $('#registerform').show(200)
    })

    $('.back').on('click', function(){
      $('#loginform').show(200)
      $('#registerform').hide(200)
    })
  })
  </script>
</html>
